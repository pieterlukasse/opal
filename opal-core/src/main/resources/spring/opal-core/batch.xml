<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:batch="http://www.springframework.org/schema/batch"
    xsi:schemaLocation="http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch-2.2.xsd
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

  <batch:job-repository id="jobRepository" data-source="opalDataSource" transaction-manager="transactionManager"/>

  <bean id="taskExecutor" class="org.springframework.core.task.SimpleAsyncTaskExecutor"/>

  <bean id="jobLauncher" class="org.springframework.batch.core.launch.support.SimpleJobLauncher">
    <property name="jobRepository" ref="jobRepository"/>
    <property name="taskExecutor" ref="taskExecutor"/>
  </bean>

  <job id="importJob" xmlns="http://www.springframework.org/schema/batch">
    <step id="importSingleTableStep">
      <tasklet>
        <chunk reader="importItemReader" processor="noopItemProcessor" writer="itemDeleter" commit-interval="1"/>
      </tasklet>
    </step>
  </job>

  <bean id="importItemReader" class="org.springframework.batch.item.database.HibernateCursorItemReader">
    <property name="sessionFactory" ref="opalSessionFactory"/>
    <property name="queryString" value="from ImportConfig where jobId = #jobParameters['jobId']"/>
  </bean>

  <bean id="importProcessor" class="org.obiba.opal.core.service.batch.ImportProcessor"/>

  <bean id="noopItemProcessor" class="org.obiba.opal.core.service.batch.NoopItemProcessor"/>

  <bean id="itemDeleter" class="org.obiba.opal.core.service.batch.HibernateItemDeleter">
    <property name="sessionFactory" ref="opalSessionFactory"/>
  </bean>

</beans>
